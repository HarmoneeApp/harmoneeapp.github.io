<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="theme-color" content="#ff512f">
		<title>Harmonee</title>
		<link rel="icon" href="img/logo.png">
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap">
		<link rel="stylesheet" href="css/style.css">
	</head>
	<body>
		<!-- Firebase SDKs -->
		<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
		<!-- Other SDKs -->
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
		<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
		<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
		<!-- Firebase Configuration -->
		<script>
			// Your web app's Firebase configuration
			var firebaseConfig = {
				apiKey: "AIzaSyBEZIIAwiXw-UwNZKmsk9ac-5EprpBRV28",
				authDomain: "harmonee-eb104.firebaseapp.com",
				databaseURL: "https://harmonee-eb104-default-rtdb.firebaseio.com",
				projectId: "harmonee-eb104",
				messagingSenderId: "186610294157",
				appId: "1:186610294157:web:4fde0e31525a9dd9c671c4",
				measurementId: "G-5EFYQC8WR7"
			};
			// Initialize Firebase
			firebase.initializeApp(firebaseConfig);
			firebase.analytics();
		</script>
		<!-- Navigation -->
		<div class="tab">
			<button class="tab-item" onclick="showTab(event, 'feed')" id="default">Feed</button>
			<button class="tab-item" onclick="showTab(event, 'search')">Search</button>
			<button class="tab-item" onclick="showTab(event, 'messages')">Messages</button>
			<button class="tab-item" onclick="signOutUser()">Sign Out</button>
			<button class="tab-item" onclick="showTab(event, 'profile')">Profile</button>
		</div>
		<!-- Feed -->
		<div id="feed" class="tab-content">
			<!-- New Post -->
			<div class="newpost-view">
				<textarea id="newpost-content" class="post-textarea" spellcheck="false" maxlength="420" placeholder="What's happening?" onkeyup="autogrow(this)"></textarea>
				<button class="newpost-button" onclick="createPost()">Post</button>
				<div id="count">
					<span id="current_count">0</span>
					<span id="maximum_count">/ 420</span>
				</div>
			</div>
			<!-- Posts -->
			<div id="timeline-posts">
				<div class="posts-container"></div>
			</div>
		</div>
		<!-- Search -->
		<div id="search" class="tab-content">
			<p class="tab-title">Coming Soon</p>
		</div>
		<!-- Messages -->
		<div id="messages" class="tab-content">
			<div class="conversations-container">
				<aside class="conversations">
					<div class="conversations-header">
						<div class="convos-label">Conversations</div>
						<div class="new-conversation" onclick="listFollowedUsers()">+</div>
					</div>
					<div class="conversation-list"></div>
				</aside>
				<main class="chat-area">
					<div class="chat-header">No Conversation Loaded</div>
					<div class="messages"></div>
					<div class="newmessage-container">
						<textarea id="newmessage-content" class="newmessage-textarea" spellcheck="true" maxlength="420" placeholder="Type your message..." onkeyup="autogrow(this)"></textarea>
						<button class="newmessage-button" id="sendMessage">Send</button>
					</div>
				</main>
			</div>
		</div>
		<!-- My Profile -->
		<div id="profile" class="tab-content">
			<div class="profile-header">
				<img class="profile-image">
				<div class="profile-info">
					<span class="profile-displayname"></span>
					<span class="profile-username"></span>
					<div class="profile-stats">
						<div class="profile-stat">
							<span class="profile-statlabel">Following</span>
							<span class="profile-following"></span>
						</div>
						<div class="profile-stat">
							<span class="profile-statlabel">Followers</span>
							<span class="profile-followers"></span>
						</div>
					</div>
				</div>					
				<div class="profile-button" onclick="editProfile()">Edit Profile</div>
			</div>
			<div id="edit-profile" class="modal">
				<div class="modal-content">
					<div class="modal-header">
						<p class="header-text">Edit Profile</p>
					</div>
					<div class="modal-body">
						<center>
							<div class="update-avatar">
								<input type="file" accept="image/jpeg, image/png" id="edit-avatar">
								<label for="edit-avatar" onclick="uploadAvatar()">Upload</label>
							</div>
						</center>
						<label for="edit-displayname" class="modal-label">Display Name</label>
						<input type="text" class="modal-input" spellcheck="false" id="edit-displayname">
						<label for="edit-username" class="modal-label">Username</label>
						<input type="text" class="modal-input" spellcheck="false" id="edit-username">
					</div>
					<div class="modal-footer">
						<div class="footer-button" onclick="closeModal()">Cancel</div>
						<div class="footer-button" onclick="updateProfileInfo()">Save Changes</div>
					</div>
				</div>
			</div>
			<!-- Posts -->
			<div id="profile-posts">
				<div class="posts-container"></div>
			</div>
		</div>
		<!-- Followed Users Modal -->
		<div id="followed-users" class="global-modal">
			<div class="users-container"></div>
		</div>
		<!-- View Post Modal -->
		<div id="view-post" class="global-modal">
			<div class="postmodal-container">
				<div class="postmodal-post">
					<div class="postmodal-header">
						<img class="postmodal-avatar">
						<div class="postmodal-info">
							<span class="postmodal-displayname"></span>
							<span class="postmodal-username"></span>
						</div>
					</div>
					<p class="postmodal-content"></p>
					<div class="postmodal-footer">
						<span class="postmodal-date"></span>
					</div>
				</div>
				<div class="comment-container"></div>
				<div class="newcomment-container">
					<textarea id="newcomment-content" class="newcomment-textarea" spellcheck="false" maxlength="420" placeholder="Comment" onkeyup="autogrow(this)"></textarea>
					<button class="newcomment-button" id="createComment">Comment</button>
				</div>
			</div>
		</div>
		<!-- View Profile Modal -->
		<div id="view-profile" class="global-modal">
			<div class="profilemodal-container">
				<div class="profile-header">
					<img class="profile-image">
					<div class="profile-info">
						<span class="profile-displayname"></span>
						<span class="profile-username"></span>
						<div class="profile-stats">
							<div class="profile-stat">
								<span class="profile-statlabel">Following</span>
								<span class="profile-following"></span>
							</div>
							<div class="profile-stat">
								<span class="profile-statlabel">Followers</span>
								<span class="profile-followers"></span>
							</div>
						</div>
					</div>					
					<div class="profile-button"></div>
				</div>
				<!-- Posts -->
				<div id="user-posts">
					<div class="posts-container"></div>
				</div>
			</div>
		</div>
		<!-- Other Scripts -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://unpkg.com/sweetalert2/dist/sweetalert2.all.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
		<!-- Local Scripts -->
		<script type="module" src="js/supabase.js"></script>
		<script src="js/auth.js"></script>
		<script src="js/chat.js"></script>
		<script src="js/db.js"></script>
		<script src="js/global.js"></script>
		<script src="js/listeners.js"></script>
		<script src="js/ui.js"></script>
		<script src="js/users.js"></script>
		<script src="js/util.js"></script>
		<!-- Custom Scripts -->
		<script>
			var didSignIn = false;

			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					// User is signed in.
					didSignIn = true;

					loadProfileInfo(user.uid);

					listenForPosts();
					listenForChanges();

					listenForConversations();
				} else {
					if (didSignIn) {
						Swal.fire({
							title: "You were successfully signed out.",
							icon: "success",
							iconColor: "#10b981",
							background: "#3c4469",
							color: "#e4e4e4",
							confirmButtonColor: "#6c759b",
							confirmButtonText: "Okay"
						}).then((value) => {
							setTimeout(function() {
								window.location.replace("welcome.html");
							}, 1000);
						});
					} else {
						window.location.replace("welcome.html");
					}
				}
			});
			
			// Post Character Count
			$("#newpost-content").keyup(function() {
				var characterCount = $(this).val().length,
				current_count = $("#current_count"),
				maximum_count = $("#maximum_count"),
				count = $("#count");

				current_count.text(characterCount);
			});

			// Comment Character Count
			$("#newcomment-content").keyup(function() {
				var characterCount = $(this).val().length,
				current_count = $("#current_count"),
				maximum_count = $("#maximum_count"),
				count = $("#count");

				current_count.text(characterCount);
			});
		</script>
	</body>
</html>